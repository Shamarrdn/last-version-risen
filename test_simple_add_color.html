<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù† - Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .size-container {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .size-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .size-title {
            font-weight: bold;
            color: #007bff;
        }
        .size-select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .colors-section {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        .color-item {
            border: 1px solid #eee;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .color-select {
            flex: 1;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .color-inputs {
            display: flex;
            gap: 10px;
            flex: 2;
        }
        .input-group-sm {
            flex: 1;
        }
        .input-group-sm label {
            display: block;
            font-size: 12px;
            margin-bottom: 2px;
        }
        .input-group-sm input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .color-remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-color-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .error {
            color: #721c24;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù† - Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø©</h1>
        <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</p>
        
        <form id="testForm">
            <div id="sizeColorMatrix">
                <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ù‡Ù†Ø§ -->
            </div>
            
            <button type="button" onclick="addNewSize()">Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ø³ Ø¬Ø¯ÙŠØ¯</button>
            <button type="button" onclick="testAddColor()">Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†</button>
            <button type="button" onclick="clearConsole()">Ù…Ø³Ø­ Console</button>
        </form>
        
        <div class="test-results">
            <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <div id="testResults"></div>
        </div>
        
        <div id="console-output"></div>
    </div>

    <script>
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        let availableSizes = [
            { id: 1, name: 'XS', description: 'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹' },
            { id: 2, name: 'S', description: 'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ±' },
            { id: 3, name: 'M', description: 'Ù…Ù‚Ø§Ø³ Ù…ØªÙˆØ³Ø·' },
            { id: 4, name: 'L', description: 'Ù…Ù‚Ø§Ø³ ÙƒØ¨ÙŠØ±' }
        ];
        
        let availableColors = [
            { id: 1, name: 'Ø£Ø­Ù…Ø±', description: 'Ù„ÙˆÙ† Ø£Ø­Ù…Ø±', code: '#FF0000' },
            { id: 2, name: 'Ø£Ø²Ø±Ù‚', description: 'Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚', code: '#0000FF' },
            { id: 3, name: 'Ø£Ø®Ø¶Ø±', description: 'Ù„ÙˆÙ† Ø£Ø®Ø¶Ø±', code: '#00FF00' },
            { id: 4, name: 'Ø£ØµÙØ±', description: 'Ù„ÙˆÙ† Ø£ØµÙØ±', code: '#FFFF00' }
        ];
        
        let selectedSizes = [];
        
        // Ø§Ø¹ØªØ±Ø§Ø¶ console.log
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.textContent += args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleOutput.textContent += 'âŒ ERROR: ' + args.join(' ') + '\n';
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            consoleOutput.textContent += 'âš ï¸ WARN: ' + args.join(' ') + '\n';
        };
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ø³ Ø¬Ø¯ÙŠØ¯
        function addNewSize() {
            const newSize = {
                id: 'temp_' + Date.now(),
                name: 'Ù…Ù‚Ø§Ø³ Ø¬Ø¯ÙŠØ¯',
                colors: []
            };
            
            selectedSizes.push(newSize);
            updateSizeColorMatrix();
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
        function updateSizeColorMatrix() {
            const matrixContainer = document.getElementById('sizeColorMatrix');
            matrixContainer.innerHTML = '';
            
            selectedSizes.forEach((size, sizeIndex) => {
                const sizeContainer = document.createElement('div');
                sizeContainer.className = 'size-container';
                sizeContainer.dataset.sizeId = size.id;
                
                sizeContainer.innerHTML = `
                    <div class="size-header">
                        <div class="size-title">
                            Ø§Ù„Ù…Ù‚Ø§Ø³ ${sizeIndex + 1}
                        </div>
                        <button type="button" onclick="removeSize(${sizeIndex})" style="background: #dc3545;">
                            Ø­Ø°Ù
                        </button>
                    </div>
                    
                    <select class="size-select" onchange="updateSizeName(${sizeIndex}, this.value)">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³...</option>
                        ${availableSizes.map(s => `
                            <option value="${s.id}" ${s.id == size.id ? 'selected' : ''}>
                                ${s.name} - ${s.description}
                            </option>
                        `).join('')}
                    </select>
                    
                    <div class="colors-section">
                        <h6>Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©</h6>
                        <div class="size-colors-container" id="size-colors-${size.id}">
                            ${size.colors.map(color => `
                                <div class="color-item" data-color-id="${color.id}">
                                    <select class="color-select" onchange="updateColorName(this, '${size.id}')">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†...</option>
                                        ${availableColors.map(c => `
                                            <option value="${c.id}" ${c.id == color.id ? 'selected' : ''}>
                                                ${c.name} - ${c.description}
                                            </option>
                                        `).join('')}
                                    </select>
                                    
                                    <div class="color-inputs">
                                        <div class="input-group-sm">
                                            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹:</label>
                                            <input type="number" 
                                                name="stock[${size.id}][${color.id}]" 
                                                placeholder="50"
                                                min="0"
                                                value="${color.stock || ''}"
                                                required>
                                        </div>
                                        <div class="input-group-sm">
                                            <label>Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³):</label>
                                            <input type="number" 
                                                name="price[${size.id}][${color.id}]" 
                                                placeholder="150"
                                                step="0.01"
                                                min="0"
                                                value="${color.price || ''}">
                                        </div>
                                    </div>
                                    
                                    <button type="button" class="color-remove-btn" onclick="removeColor('${size.id}', '${color.id}')">
                                        Ã—
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button type="button" class="add-color-btn" onclick="addColorToSize('${size.id}')">
                            + Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†
                        </button>
                    </div>
                `;
                
                matrixContainer.appendChild(sizeContainer);
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† Ù„Ù…Ù‚Ø§Ø³ (Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡)
        function addColorToSize(sizeId) {
            console.log('Adding color to size:', sizeId);
            
            const size = selectedSizes.find(s => s.id === sizeId);
            if (!size) {
                console.error('Size not found:', sizeId);
                return;
            }
            
            const newColor = {
                id: 'temp_color_' + Date.now(),
                name: '',
                stock: '',
                price: ''
            };
            
            size.colors.push(newColor);
            
            // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ØŒ Ø£Ø¶Ù Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·
            addColorToUI(size, newColor);
            
            console.log('Color added successfully to size:', size.id, 'Total colors:', size.colors.length);
        }
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡) - Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø©
        function addColorToUI(size, color) {
            console.log('Adding color to UI for size:', size.id, 'color:', color);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø¨Ø³Ø·Ø© ÙˆÙ…ÙˆØ«ÙˆÙ‚Ø©
            let colorsContainer = null;
            
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù€ ID Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
            colorsContainer = document.querySelector(`#size-colors-${size.id}`);
            console.log('Method 1 - Direct ID search:', colorsContainer ? 'Found' : 'Not found');
            
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
            if (!colorsContainer) {
                const allContainers = document.querySelectorAll('.size-colors-container');
                console.log('Found', allContainers.length, 'color containers');
                
                for (let container of allContainers) {
                    const sizeContainer = container.closest('.size-container');
                    if (sizeContainer) {
                        const containerSizeId = sizeContainer.dataset.sizeId;
                        console.log('Container size ID:', containerSizeId, 'Looking for:', size.id);
                        
                        if (String(containerSizeId) === String(size.id)) {
                            colorsContainer = container;
                            console.log('Found matching container!');
                            break;
                        }
                    }
                }
            }
            
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 3: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
            if (!colorsContainer) {
                const allSizeContainers = document.querySelectorAll('.size-container');
                console.log('Found', allSizeContainers.length, 'size containers');
                
                for (let sizeContainer of allSizeContainers) {
                    const containerSizeId = sizeContainer.dataset.sizeId;
                    console.log('Size container ID:', containerSizeId, 'Looking for:', size.id);
                    
                    if (String(containerSizeId) === String(size.id)) {
                        const container = sizeContainer.querySelector('.size-colors-container');
                        if (container) {
                            colorsContainer = container;
                            console.log('Found container in size container!');
                            break;
                        }
                    }
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ù„ Ø§Ù„Ø¨Ø¯ÙŠÙ„
            if (!colorsContainer) {
                console.error('Colors container not found for size:', size.id);
                console.log('Available size containers:', Array.from(document.querySelectorAll('.size-container')).map(c => c.dataset.sizeId));
                console.log('Available color containers:', Array.from(document.querySelectorAll('.size-colors-container')).length);
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØµÙÙˆÙØ© ÙƒØ§Ù…Ù„Ø© ÙƒØ­Ù„ Ø¨Ø¯ÙŠÙ„
                console.log('Falling back to full matrix update');
                updateSizeColorMatrix();
                return;
            }
            
            console.log('Found colors container:', colorsContainer);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const colorItem = document.createElement('div');
            colorItem.className = 'color-item';
            colorItem.dataset.colorId = color.id;
            
            colorItem.innerHTML = `
                <select class="color-select" onchange="updateColorName(this, '${size.id}')">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†...</option>
                    ${availableColors.map(c => `
                        <option value="${c.id}" ${c.id == color.id ? 'selected' : ''}>
                            ${c.name} - ${c.description}
                        </option>
                    `).join('')}
                </select>
                
                <div class="color-inputs">
                    <div class="input-group-sm">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹:</label>
                        <input type="number" 
                            name="stock[${size.id}][${color.id}]" 
                            placeholder="50"
                            min="0"
                            value="${color.stock || ''}"
                            required>
                    </div>
                    <div class="input-group-sm">
                        <label>Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³):</label>
                        <input type="number" 
                            name="price[${size.id}][${color.id}]" 
                            placeholder="150"
                            step="0.01"
                            min="0"
                            value="${color.price || ''}">
                    </div>
                </div>
                
                <button type="button" class="color-remove-btn" onclick="removeColor('${size.id}', '${color.id}')">
                    Ã—
                </button>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ù„Ù„Ø­Ø§ÙˆÙŠØ©
            colorsContainer.appendChild(colorItem);
            console.log('Color item added successfully to container');
        }
        
        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…Ù‚Ø§Ø³
        function removeSize(sizeIndex) {
            selectedSizes.splice(sizeIndex, 1);
            updateSizeColorMatrix();
        }
        
        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù„ÙˆÙ†
        function removeColor(sizeId, colorId) {
            const size = selectedSizes.find(s => s.id === sizeId);
            if (size) {
                size.colors = size.colors.filter(c => c.id !== colorId);
                updateSizeColorMatrix();
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ø³
        function updateSizeName(sizeIndex, sizeId) {
            if (selectedSizes[sizeIndex]) {
                selectedSizes[sizeIndex].id = sizeId;
                const sizeData = availableSizes.find(s => s.id == sizeId);
                if (sizeData) {
                    selectedSizes[sizeIndex].name = sizeData.name;
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù„ÙˆÙ†
        function updateColorName(selectElement, sizeId) {
            const colorItem = selectElement.closest('.color-item');
            const colorId = selectElement.value;
            const size = selectedSizes.find(s => s.id === sizeId);
            
            if (size && colorId) {
                const color = size.colors.find(c => c.id === colorItem.dataset.colorId);
                if (color) {
                    color.id = colorId;
                    const colorData = availableColors.find(c => c.id == colorId);
                    if (colorData) {
                        color.name = colorData.name;
                    }
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†
        function testAddColor() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            console.log('=== Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† ===');
            
            if (selectedSizes.length === 0) {
                results.innerHTML = '<div class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ø³Ø§Øª Ù…ØªØ§Ø­Ø©. Ø£Ø¶Ù Ù…Ù‚Ø§Ø³ Ø£ÙˆÙ„Ø§Ù‹.</div>';
                return;
            }
            
            const firstSize = selectedSizes[0];
            const initialColorCount = firstSize.colors.length;
            
            console.log('Initial color count:', initialColorCount);
            
            // Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯
            addColorToSize(firstSize.id);
            
            const finalColorCount = firstSize.colors.length;
            console.log('Final color count:', finalColorCount);
            
            if (finalColorCount > initialColorCount) {
                results.innerHTML = `
                    <div class="success">
                        âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­!<br>
                        - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${initialColorCount}<br>
                        - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${finalColorCount}<br>
                        - ØªÙ… Ø¥Ø¶Ø§ÙØ©: ${finalColorCount - initialColorCount} Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯
                    </div>
                `;
                console.log('âœ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¬Ø­!');
            } else {
                results.innerHTML = '<div class="error">âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ†</div>';
                console.error('âŒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙØ´Ù„!');
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø­ Console
        function clearConsole() {
            consoleOutput.textContent = '';
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ø³ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...');
            addNewSize();
            console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ø³ Ø§ÙØªØ±Ø§Ø¶ÙŠ');
        });
    </script>
</body>
</html>
